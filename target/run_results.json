{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.1", "generated_at": "2025-01-14T14:45:47.176005Z", "invocation_id": "359bb2c6-a729-44b7-a461-70a01eaa22b6", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:34.708542Z", "completed_at": "2025-01-14T14:45:34.727520Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:34.774521Z", "completed_at": "2025-01-14T14:45:36.111896Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.4373588562011719, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "b03a45c0-fa7d-4e5f-b856-d1720aae9c19", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_sumup.stg_leads_funnel", "compiled": true, "compiled_code": "WITH cleaned_leads_funnel AS (\n    SELECT\n        DATE AS lead_activity_date,\n        COUNTRY_CODE AS country_code,\n        CAMPAIGN_ID AS campaign_id,\n        PRODUCT AS product,\n        CHANNEL_3 AS channel_level_3,\n        CHANNEL_4 AS channel_level_4,\n        CHANNEL_5 AS channel_level_5,\n        SAFE_CAST(TOTAL_IMPRESSIONS AS INT64) AS total_impressions,\n        SAFE_CAST(TOTAL_CLICKS AS INT64) AS total_clicks,\n        SAFE_CAST(TOTAL_SPEND AS FLOAT64) AS total_spend,\n        SAFE_CAST(TOTAL_LEADS AS INT64) AS total_leads,\n        SAFE_CAST(TOTAL_FAKE_LEADS AS INT64) AS total_fake_leads,\n        SAFE_CAST(TOTAL_SQLS AS INT64) AS total_sqls,\n        SAFE_CAST(TOTAL_MEETING_DONE AS INT64) AS total_meeting_done,\n        SAFE_CAST(TOTAL_SIGNED_LEADS AS INT64) AS total_signed_leads,\n        SAFE_CAST(TOTAL_POS_LITE_DEALS AS INT64) AS total_pos_lite_deals\n    FROM `dbt-analytics-392621`.`raw_data`.`leads_funnel`\n)\n\nSELECT * FROM cleaned_leads_funnel", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`stg_leads_funnel`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:34.690541Z", "completed_at": "2025-01-14T14:45:34.725516Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:34.729521Z", "completed_at": "2025-01-14T14:45:36.113877Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4403584003448486, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "25b3d79c-30c6-477f-b1d6-981511633888", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_sumup.stg_channels", "compiled": true, "compiled_code": "WITH cleaned_channels AS (\n    SELECT\n        CAMPAIGN_ID AS campaign_id,\n        CAMPAIGN_NAME AS campaign_name,\n        CAMPAIGN_PERIOD_BUDGET_CATEGORY AS budget_category,\n        CHANNEL_3 AS channel_level_3,\n        CHANNEL_4 AS channel_level_4,\n        CHANNEL_5 AS channel_level_5\n    FROM `dbt-analytics-392621`.`raw_data`.`channels`\n)\n\nSELECT * FROM cleaned_channels", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`stg_channels`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:34.717519Z", "completed_at": "2025-01-14T14:45:34.758518Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:34.807516Z", "completed_at": "2025-01-14T14:45:36.120876Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.4363784790039062, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "b5c289f1-36ac-4454-b061-4b0b95bf5332", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_sumup.stg_web_orders", "compiled": true, "compiled_code": "WITH cleaned_web_orders AS (\n    SELECT\n        DATE AS activity_date,\n        COUNTRY_CODE AS country_code,\n        CAMPAIGN_ID AS campaign_id,\n        SAFE_CAST(TOTAL_SPEND_EUR AS FLOAT64) AS total_spend_eur,\n        SAFE_CAST(NB_OF_SESSIONS AS INT64) AS nb_of_sessions,\n        SAFE_CAST(NB_OF_SIGNUPS AS INT64) AS nb_of_signups,\n        SAFE_CAST(NB_OF_ORDERS AS INT64) AS nb_of_orders,\n        SAFE_CAST(NB_OF_POSLITE_ITEMS_ORDERED AS INT64) AS nb_of_poslite_items_ordered,\n        SAFE_CAST(NB_POSLITE_ITEMS_DISPATCHED AS INT64) AS nb_poslite_items_dispatched\n    FROM `dbt-analytics-392621`.`raw_data`.`web_orders`\n)\n\nSELECT * FROM cleaned_web_orders", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`stg_web_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:36.157482Z", "completed_at": "2025-01-14T14:45:36.258396Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:36.263751Z", "completed_at": "2025-01-14T14:45:39.933884Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 3.779405355453491, "adapter_response": {"_message": "CREATE TABLE (9.9k rows, 313.0 KiB processed)", "code": "CREATE TABLE", "rows_affected": 9885, "bytes_processed": 320515, "bytes_billed": 20971520, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "19d322ab-6d57-47ec-a095-ef41d2beced0", "slot_ms": 10161}, "message": "CREATE TABLE (9.9k rows, 313.0 KiB processed)", "failures": null, "unique_id": "model.dbt_sumup.mart_web_orders", "compiled": true, "compiled_code": "WITH web_order_metrics AS (\n    SELECT\n        wo.activity_date,\n        wo.country_code,\n        wo.campaign_id,\n        ch.channel_level_3,\n        ch.channel_level_4,\n        ch.channel_level_5,\n        wo.nb_of_sessions,\n        wo.nb_of_signups,\n        wo.nb_of_orders,\n        wo.nb_of_poslite_items_ordered,\n        wo.nb_poslite_items_dispatched,\n        wo.total_spend_eur,\n        \n        -- Click Through Rate (CTR)\n        SAFE_DIVIDE(wo.nb_of_signups, wo.nb_of_sessions) * 100 AS ctr,\n        \n        -- Costo per order\n        SAFE_DIVIDE(wo.total_spend_eur, NULLIF(wo.nb_of_orders, 0)) AS cost_per_order,\n\n        -- Cost per session\n        SAFE_DIVIDE(wo.total_spend_eur, wo.nb_of_sessions) AS cost_per_session,\n\n        --Conversion rate fron sessions to orders\n        SAFE_DIVIDE(wo.nb_of_orders, wo.nb_of_sessions) * 100 AS conversion_rate_orders\n\n\n    FROM `dbt-analytics-392621`.`pos_lite_dbt`.`stg_web_orders` wo\n    LEFT JOIN `dbt-analytics-392621`.`pos_lite_dbt`.`stg_channels` ch\n      ON wo.campaign_id = ch.campaign_id\n)\nSELECT * FROM web_order_metrics", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`mart_web_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:36.148481Z", "completed_at": "2025-01-14T14:45:36.166476Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:36.168474Z", "completed_at": "2025-01-14T14:45:39.940884Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.79640793800354, "adapter_response": {"_message": "CREATE TABLE (3.7k rows, 530.2 KiB processed)", "code": "CREATE TABLE", "rows_affected": 3736, "bytes_processed": 542919, "bytes_billed": 10485760, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "7d2cea2c-51c7-45a4-bdb6-61febbfe8cc2", "slot_ms": 4699}, "message": "CREATE TABLE (3.7k rows, 530.2 KiB processed)", "failures": null, "unique_id": "model.dbt_sumup.mart_leads_funnel", "compiled": true, "compiled_code": "WITH lead_metrics AS (\n    SELECT\n        lead_activity_date AS activity_date,\n        country_code,\n        campaign_id,\n        product,\n        channel_level_3,\n        channel_level_4,\n        channel_level_5,\n        total_leads,\n        total_fake_leads,\n        total_sqls,\n        total_meeting_done,\n        total_signed_leads,\n        total_pos_lite_deals,\n        total_spend,\n        total_impressions,\n        total_clicks,\n        \n        -- Conversion rate from leads to SQLs\n        SAFE_DIVIDE(total_sqls, total_leads) * 100 AS conversion_rate_sqls,\n        \n        -- Conversion rate from SQLs to meetings\n        SAFE_DIVIDE(total_meeting_done, total_sqls) * 100 AS conversion_rate_meetings,\n        \n        -- Conversion rate from meetings to signed leads\n        SAFE_DIVIDE(total_signed_leads, total_meeting_done) * 100 AS conversion_rate_signed_leads,\n                \n        -- Conversion rate from leads to deals for POS Lite\n        SAFE_DIVIDE(total_pos_lite_deals, total_signed_leads) * 100 AS conversion_rate_pos_deals,\n        \n        -- Conversion rate of leads to final deals\n        SAFE_DIVIDE(total_pos_lite_deals, total_leads) * 100 AS conversion_rate_deals,\n        \n        -- Cost per lead\n        SAFE_DIVIDE(total_spend, total_leads) AS cost_per_lead,\n\n        -- Costo per POS deal\n        SAFE_DIVIDE(total_spend, total_pos_lite_deals) AS cost_per_deal,\n\n        -- Cost per SQL\n        SAFE_DIVIDE(total_spend, total_sqls) AS cost_per_sql,\n\n        -- Click Through Rate (CTR)\n        SAFE_DIVIDE(total_clicks, total_impressions) * 100 AS ctr\n    FROM `dbt-analytics-392621`.`pos_lite_dbt`.`stg_leads_funnel`\n)\n\nSELECT * FROM lead_metrics", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`mart_leads_funnel`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:39.952863Z", "completed_at": "2025-01-14T14:45:39.961865Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:39.962861Z", "completed_at": "2025-01-14T14:45:43.619278Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.670413017272949, "adapter_response": {"_message": "CREATE TABLE (14.4k rows, 1.9 MiB processed)", "code": "CREATE TABLE", "rows_affected": 14440, "bytes_processed": 2014866, "bytes_billed": 20971520, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "ab3f93e4-21aa-43f3-9966-698bc43133b7", "slot_ms": 9006}, "message": "CREATE TABLE (14.4k rows, 1.9 MiB processed)", "failures": null, "unique_id": "model.dbt_sumup.mart_combined_analysis", "compiled": true, "compiled_code": "WITH combined_metrics AS (\n    SELECT\n        COALESCE(wo.activity_date, lf.activity_date) AS activity_date,\n        COALESCE(wo.country_code, lf.country_code) AS country_code,\n        COALESCE(wo.campaign_id, lf.campaign_id) AS campaign_id,\n        COALESCE(wo.channel_level_3, lf.channel_level_3) AS channel_level_3,\n        COALESCE(wo.channel_level_4, lf.channel_level_4) AS channel_level_4,\n        COALESCE(wo.channel_level_5, lf.channel_level_5) AS channel_level_5,\n        \n        -- Web order metrics\n        wo.nb_of_sessions,\n        wo.nb_of_signups,\n        wo.nb_of_orders,\n        wo.nb_of_poslite_items_ordered,\n        wo.nb_poslite_items_dispatched,\n        wo.total_spend_eur,\n        wo.ctr AS web_order_ctr,\n        wo.cost_per_order,\n        \n        -- Lead funnel metrics\n        lf.total_leads,\n        lf.total_sqls,\n        lf.total_meeting_done,\n        lf.total_signed_leads,\n        lf.total_pos_lite_deals,\n        lf.product,\n        lf.total_spend AS lead_total_spend,\n        lf.conversion_rate_sqls,\n        lf.conversion_rate_meetings,\n        lf.conversion_rate_signed_leads,\n        lf.conversion_rate_deals,\n        lf.conversion_rate_pos_deals,\n        lf.cost_per_lead,\n        lf.cost_per_deal,\n        lf.ctr AS lead_ctr,\n\n        -- Total combined cost\n        COALESCE(wo.total_spend_eur, 0) + COALESCE(lf.total_spend, 0) AS total_combined_spend\n        \n    FROM `dbt-analytics-392621`.`pos_lite_dbt`.`mart_web_orders` wo\n    FULL OUTER JOIN `dbt-analytics-392621`.`pos_lite_dbt`.`mart_leads_funnel` lf\n      ON wo.activity_date = lf.activity_date\n     AND wo.country_code = lf.country_code\n     AND wo.campaign_id = lf.campaign_id\n)\n\nSELECT * FROM combined_metrics", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`mart_combined_analysis`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:43.634280Z", "completed_at": "2025-01-14T14:45:43.650296Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:43.651275Z", "completed_at": "2025-01-14T14:45:46.647735Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 3.0164597034454346, "adapter_response": {"_message": "CREATE TABLE (6.3k rows, 1.8 MiB processed)", "code": "CREATE TABLE", "rows_affected": 6268, "bytes_processed": 1898322, "bytes_billed": 10485760, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "f5a87129-d0bc-41d3-b83c-77ccc35a6d80", "slot_ms": 3831}, "message": "CREATE TABLE (6.3k rows, 1.8 MiB processed)", "failures": null, "unique_id": "model.dbt_sumup.rep_agg", "compiled": true, "compiled_code": "-- Modelo de reporting basado en el mart combinado\nWITH aggregated_metrics AS (\n    SELECT\n        activity_date,\n        country_code,\n        campaign_id,\n        channel_level_3,\n        channel_level_4,\n        channel_level_5,\n        \n        -- M\u00e9tricas de web orders\n        SUM(nb_of_sessions) AS total_sessions,\n        SUM(nb_of_signups) AS total_signups,\n        SUM(nb_of_orders) AS total_orders,\n        SUM(nb_of_poslite_items_ordered) AS total_poslite_items_ordered,\n        SUM(nb_poslite_items_dispatched) AS total_poslite_items_dispatched,\n        SUM(total_spend_eur) AS total_spend_web,\n        \n        -- M\u00e9tricas de leads funnel\n        SUM(total_leads) AS total_leads,\n        SUM(total_sqls) AS total_sqls,\n        SUM(total_meeting_done) AS total_meeting_done,\n        SUM(total_signed_leads) AS total_signed_leads,\n        SUM(total_pos_lite_deals) AS total_pos_lite_deals,\n        SUM(lead_total_spend) AS total_spend_leads,\n        \n        -- Costo total combinado\n        SUM(total_spend_eur) + SUM(lead_total_spend) AS total_combined_spend,\n        \n        -- Conversi\u00f3n final combinada de leads a \u00f3rdenes\n        SAFE_DIVIDE(SUM(nb_of_orders), SUM(total_leads)) * 100 AS combined_conversion_rate,\n        \n        -- CTR combinado\n        SAFE_DIVIDE(SUM(nb_of_signups), SUM(nb_of_sessions)) * 100 AS combined_ctr\n        \n    FROM `dbt-analytics-392621`.`pos_lite_dbt`.`mart_combined_analysis`\n    GROUP BY\n        activity_date,\n        country_code,\n        campaign_id,\n        channel_level_3,\n        channel_level_4,\n        channel_level_5\n)\n\nSELECT * FROM aggregated_metrics", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`rep_agg`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-14T14:45:43.645274Z", "completed_at": "2025-01-14T14:45:43.665275Z"}, {"name": "execute", "started_at": "2025-01-14T14:45:43.667274Z", "completed_at": "2025-01-14T14:45:47.160025Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.526749610900879, "adapter_response": {"_message": "CREATE TABLE (14.4k rows, 2.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 14440, "bytes_processed": 2461559, "bytes_billed": 10485760, "location": "US", "project_id": "dbt-analytics-392621", "job_id": "c5002003-370b-430c-b261-6677c90ff0d6", "slot_ms": 4572}, "message": "CREATE TABLE (14.4k rows, 2.3 MiB processed)", "failures": null, "unique_id": "model.dbt_sumup.rep_complete", "compiled": true, "compiled_code": "SELECT * \nFROM `dbt-analytics-392621`.`pos_lite_dbt`.`mart_combined_analysis`", "relation_name": "`dbt-analytics-392621`.`pos_lite_dbt`.`rep_complete`", "batch_results": null}], "elapsed_time": 13.416202068328857, "args": {"use_colors_file": true, "empty": false, "partial_parse": true, "log_level_file": "debug", "source_freshness_run_project_hooks": false, "require_batched_execution_for_custom_microbatch_strategy": false, "print": true, "project_dir": "C:\\Users\\Lenovo\\Documents\\Gonza\\Trabajo\\Ejercicios\\SumUp\\dbt_sumup", "exclude": [], "log_format": "default", "static_parser": true, "select": [], "show_resource_report": false, "profiles_dir": "C:\\Users\\Lenovo\\.dbt", "warn_error_options": {"include": [], "exclude": []}, "log_level": "info", "macro_debugging": false, "require_explicit_package_overrides_for_builtin_materializations": true, "log_file_max_bytes": 10485760, "require_yaml_configuration_for_mf_time_spines": false, "send_anonymous_usage_stats": true, "state_modified_compare_more_unrendered_values": false, "version_check": true, "use_colors": true, "indirect_selection": "eager", "favor_state": false, "vars": {}, "require_resource_names_without_spaces": false, "partial_parse_file_diff": true, "require_nested_cumulative_type_params": false, "strict_mode": false, "log_path": "C:\\Users\\Lenovo\\Documents\\Gonza\\Trabajo\\Ejercicios\\SumUp\\dbt_sumup\\logs", "introspect": true, "printer_width": 80, "state_modified_compare_vars": false, "cache_selected_only": false, "defer": false, "invocation_command": "dbt run", "skip_nodes_if_on_run_start_fails": false, "write_json": true, "populate_cache": true, "log_format_file": "debug", "which": "run", "quiet": false}}